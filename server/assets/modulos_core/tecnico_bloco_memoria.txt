---
id: BLOCO_TECNICO_MEMORIA_V3
minIntensity: 7
opennessIn: [2, 3]
flagsAny: [hasTechBlock, saveMemory, significantInsight, patternDetected, turningPoint]
injectAs: footer
dedupeKey: blocoTecnicoMemoriaV3
---

# Schema de Registro de Memória V3

## Estrutura JSON Completa

```json
{
  "metadata": {
    "timestamp": "{{ISO_8601}}",
    "session_id": "{{SESSION_UUID}}",
    "turn_number": {{TURN_NUMBER}},
    "registro_tipo": "padrao|insight|decisao|crise|recurso"
  },
  
  "estado_emocional": {
    "emocao_primaria": "{{DETECTED_PRIMARY}}",
    "emocoes_secundarias": ["{{SECONDARY_1}}", "{{SECONDARY_2}}"],
    "intensidade": {{0-10}},
    "qualidade": "expansiva|contrativa|mista|neutra",
    "corpo_localizacao": "{{SOMATIC_LOCATION}}",
    "energia_nivel": "colapsada|baixa|media|alta|hiperativada"
  },
  
  "contexto": {
    "dominio_vida": "trabalho|relacionamentos|familia|saude|identidade|financeiro|espiritual|criativo|outro",
    "gatilho_identificado": "{{TRIGGER_DESCRIPTION}}",
    "tempo_referencia": "passado|presente|futuro|atemporal",
    "contexto_relacional": "sozinho|intimo|familiar|social|profissional",
    "nivel_abertura": {{1-3}}
  },
  
  "padroes": {
    "padrao_principal": "{{PATTERN_NAME}}",
    "descricao": "{{PATTERN_DESCRIPTION}}",
    "frequencia_historica": "primeira_vez|esporadico|recorrente|cronico",
    "elementos_sistema": [
      {
        "tipo": "crenca|comportamento|relacional|somatico",
        "descricao": "{{ELEMENT_DESC}}"
      }
    ],
    "funcao_adaptativa": "{{ADAPTIVE_FUNCTION}}",
    "custo_atual": "{{CURRENT_COST}}"
  },
  
  "movimento": {
    "direcao_observada": "aproximacao|evitacao|paralisia|oscilacao",
    "qualidade_movimento": "forcado|natural|hesitante|fluido",
    "resistencias_identificadas": ["{{RESISTANCE_1}}"],
    "recursos_disponiveis": ["{{RESOURCE_1}}"],
    "experimento_proposto": "{{PROPOSED_EXPERIMENT}}",
    "resposta_inicial": "aceito|hesitante|recusado|adaptado"
  },
  
  "insights": {
    "nivel": "superficie|estrutura|sistema|essencia",
    "conteudo": "{{INSIGHT_CONTENT}}",
    "qualidade": "cognitivo|emocional|somatico|integral",
    "acao_potencial": "{{POTENTIAL_ACTION}}",
    "integracao_necessaria": "imediata|curto_prazo|longo_prazo|processamento"
  },
  
  "linguagem_usuario": {
    "palavras_chave": ["{{EXACT_WORD_1}}", "{{EXACT_WORD_2}}"],
    "metaforas_usadas": ["{{METAPHOR_1}}"],
    "frases_significativas": "{{SIGNIFICANT_PHRASE}}",
    "vocabulario_emocional": "basico|moderado|rico|alexitimico",
    "estilo_comunicacao": "direto|elaborado|evasivo|fragmentado"
  },
  
  "intervencao_eco": {
    "tipo_resposta": "acolhimento|exploracao|estruturacao|acao",
    "modulos_usados": ["espelho", "padrao", "convite", "pergunta", "ordem"],
    "pergunta_feita": "{{QUESTION_ASKED}}",
    "efetividade_percebida": {{1-5}},
    "ajuste_necessario": "{{ADJUSTMENT_NEEDED}}"
  },
  
  "seguranca": {
    "nivel_risco": "verde|amarelo|laranja|vermelho",
    "sinais_alerta": ["{{SIGN_1}}"],
    "protocolo_ativado": "nenhum|monitoramento|suporte|crise",
    "recursos_sugeridos": ["{{RESOURCE}}"],
    "followup_necessario": true|false
  },
  
  "continuidade": {
    "threads_relacionadas": ["{{PREVIOUS_SESSION_ID}}"],
    "temas_emergentes": ["{{THEME_1}}", "{{THEME_2}}"],
    "evolucao_observada": "{{EVOLUTION_DESC}}",
    "proxima_exploracao": "{{SUGGESTED_NEXT}}",
    "relevancia_futura": "baixa|media|alta|critica"
  },
  
  "metricas_qualidade": {
    "precisao_espelhamento": {{0.0-1.0}},
    "profundidade_alcancada": {{1-4}},
    "ressonancia_estimada": {{0.0-1.0}},
    "movimento_gerado": {{0.0-1.0}},
    "seguranca_mantida": {{0.0-1.0}}
  },
  
  "notas_processuais": {
    "observacoes_clinicas": "{{CLINICAL_NOTES}}",
    "hipoteses_trabalho": "{{WORKING_HYPOTHESIS}}",
    "contradicoes_notadas": "{{CONTRADICTIONS}}",
    "intuicoes_nao_verbalizadas": "{{INTUITIONS}}",
    "aprendizado_sistema": "{{SYSTEM_LEARNING}}"
  }
}
```

## Flags de Contexto Técnicas

### Ativação de Registro:
- `hasTechBlock`: Incluir análise técnica completa
- `saveMemory`: Garantir persistência do registro
- `significantInsight`: Detalhar descoberta em notas processuais
- `patternDetected`: Mapear sistema completo (padroes + elementos)
- `turningPoint`: Marcar mudança de fase significativa
- `crisisProtocol`: Documentar intervenção de segurança
- `resourceEmergence`: Registrar força/recurso interno descoberto

### Compressão para Sessões Longas (>20 turnos):
Comprimir registros antigos mantendo:
- Palavras-chave exatas do usuário
- Padrões principais identificados
- Pontos de virada significativos
- Recursos descobertos
- Insights de nível sistema/essência

Descartar:
- Detalhes processuais redundantes
- Hipóteses não confirmadas
- Métricas de baixa relevância
- Notas já integradas em padrões posteriores

### Privacidade e Ética:
- Anonimizar referências a terceiros
- Não registrar informações identificáveis desnecessárias
- Marcar registros sensíveis com flag de privacidade
- Permitir pedidos de "esquecimento" de tópicos específicos
- Separar fatos observados de interpretações nas notas

---

**Nota técnica**: Critérios de ativação, protocolo de recuperação e política de memória estão definidos em `instrucoes_sistema.txt` e `promptIdentity.ts`. Este módulo serve apenas como schema de dados.